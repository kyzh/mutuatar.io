<% if defined?(mortgage) %>
  <% m = Morgage.new(mortgage["property"].to_i,  mortgage["deposit"].to_i, mortgage["interest"].to_f, mortgage["length"].to_i, mortgage["conveyancing"].to_i, mortgage["survey"].to_i, mortgage["appreciation_rate"].to_f, mortgage["depreciation_length"].to_f,mortgage["insurance"].to_i, mortgage["rent"].to_i, mortgage["ground_lease"].to_i, mortgage["charges"].to_i, mortgage["added_value"].to_i, mortgage["occupancy"].to_i, mortgage["resell"].to_i ) %>
<form action='/mortgage' method='post'>
  <div class="row-fluid">
    <div class="span12">
      <div class="row-fluid"> 
        <div class="span4">
          <h3>Morgage details</h3>
          <div class="input-prepend input-append"><span class="add-on"><i class="icon-home" ></i></span><input type="text" id="property" name="property" value="<%=m.property.to_i%>" rel="tooltip" title="Property value" data-placement="bottom"></div>
          <div class="input-prepend input-append"><span class="add-on"><i class="icon-align-right"></i></span><input type="text" id="interest" name="interest" value="<%=m.interest.to_f%>" rel="tooltip" title="Interest rate" data-placement="bottom"></div>
          <div class="input-prepend input-append"><span class="add-on"><i class="icon-download-alt"></i></span><input type="text" id="deposit" name="deposit" value="<%=m.deposit_rate.to_i%>" rel="tooltip" title="Deposit (in percent of the property)" data-placement="bottom"></div>
          <div class="input-prepend input-append"><span class="add-on"><i class="icon-calendar"></i></span><input type="text" id="length" name="length" value="<%=m.length.to_i%>"rel="tooltip" title="Mortgage lenght in months" data-placement="bottom" ></div>
          <div class="input-prepend input-append"><span class="add-on"><i class="icon-star"></i></span><input type="text" id="added_value" name="added_value" value="<%=m.added_value.to_i%>"rel="tooltip" title="Amount put toward adding value to the property (addingrefurnishment etc..)" data-placement="bottom" ></div>
        </div>
        <div class="span4">
          <h3>Cost details</h3>
            <div class="input-prepend input-append"><span class="add-on"><i class="icon-check"></i></span><input type="text" id="survey" name="survey" value="<%=m.survey.to_i%>" rel="tooltip" title="Survey cost" data-placement="bottom" ></div>
            <div class="input-prepend input-append"><span class="add-on"><i class="icon-book"></i></span><input type="text" id="conveyancing" name="conveyancing" value="<%=m.conveyancing.to_i%>" rel="tooltip" title="Conveyancing cost" data-placement="bottom" ></div>
            <div class="input-prepend input-append"><span class="add-on"><i class="icon-map-marker"></i></span><input type="text" id="ground_lease" name="ground_lease" value="<%=m.ground_lease.to_i%>" rel="tooltip" title="Yearly ground lease cost" data-placement="bottom" ></div>
            <div class="input-prepend input-append"><span class="add-on"><i class="icon-wrench"></i></span><input type="text" id="charges" name="charges" value="<%=m.charges.to_i%>" rel="tooltip" title="Yearly service charges" data-placement="bottom" ></div>
            <div class="input-prepend input-append"><span class="add-on"><i class="icon-warning-sign"></i></span><input type="text" id="insurance" name="insurance" value="<%=m.insurance.to_i%>" rel="tooltip" title="Yearly insurance charges" data-placement="bottom" ></div>
        </div>
        <div class="span4">
          <h3>Investment details</h3>
          <div class="input-prepend input-append"><span class="add-on"><i class="icon-arrow-up"></i></span><input type="text" id="appreciation_rate" name="appreciation_rate" value="<%=m.appreciation_rate.to_f%>"rel="tooltip" title="Appreciation rate" data-placement="bottom" ></div>
          <div class="input-prepend input-append"><span class="add-on"><i class="icon-arrow-down"></i></span><input type="text" id="depreciation_length" name="depreciation_length" value="<%=m.depreciation_length.to_f%>" rel="tooltip" title="Depreciation rate (expressed in years)" data-placement="bottom" ></div>
          <div class="input-prepend input-append"><span class="add-on"><i class="icon-gift"></i></span><input type="text" id="rent" name="rent" value="<%=m.rent.to_i%>"rel="tooltip" title="Potential monthly rent" data-placement="bottom"></div>
          <div class="input-prepend input-append"><span class="add-on"><i class="icon-user"></i></span><input type="text" id="occupancy" name="occupancy" value="<%=m.occupancy.to_f%>"rel="tooltip" title="Occupancy rate" data-placement="bottom"></div>
	  <div class="input-prepend input-append"><span class="add-on"><i class="icon-calendar"></i></span><input type="text" id="resell" name="resell" value="<%=m.resell.to_i%>"rel="tooltip" title="Month to resell" data-placement="bottom"></div>
        </div>
      </div>
      <input class="btn btn-inverse" type='submit' value='Breakdown'>
    </div>
  </div>
</form>
<div class="row-fluid">
  <div class="span12">
    <div class="row-fluid">
      <div class="span4">
        <h3>Morgage breakdown</h3>
        <div class="input-prepend input-append "><span class="add-on"><i class="icon-play"></i></span><span class="input-large uneditable-input" rel="tooltip" title="Monthly repayment" data-placement="bottom"><%=m.monthly_repayment.to_f.round(2)%></span></div>
        <div class="input-prepend input-append "><span class="add-on"><i class="icon-pencil"></i></span><span class="input-large uneditable-input" rel="tooltip" title="Upfront cost" data-placement="bottom"><%=m.upfront_paid.to_i%></span></div>
        <div class="input-prepend input-append "><span class="add-on"><i class="icon-shopping-cart"></i></span><span class="input-large uneditable-input" rel="tooltip" title="Amount borrowed" data-placement="bottom"><%=m.principal.to_i%></span></div>
        <div class="input-prepend input-append "><span class="add-on"><i class="icon-tags"></i></span><span class="input-large uneditable-input" rel="tooltip" title="Total spendings" data-placement="bottom"><%=m.overall_spending.to_f.round(2)%></span></div>
      </div>
      <div class="span4">
        <h3>Cost totals</h3>
        <div class="input-prepend input-append "><span class="add-on"><i class="icon-briefcase"></i></span><span class="input-large uneditable-input" rel="tooltip" title="Interest cost" data-placement="bottom"><%=m.interest_paid.to_i%></span></div>
        <div class="input-prepend input-append "><span class="add-on"><i class="icon-flag"></i></span><span class="input-large uneditable-input" rel="tooltip" title="Stamp duty cost" data-placement="bottom"><%=m.stamp_duty.to_f.round(2)%></span></div>
        <div class="input-prepend input-append "><span class="add-on"><i class="icon-briefcase"></i></span><span class="input-large uneditable-input" rel="tooltip" title="Fees cost" data-placement="bottom"><%=m.fees.to_i%></span></div>
        <div class="input-prepend input-append "><span class="add-on"><i class="icon-trash"></i></span><span class="input-large uneditable-input" rel="tooltip" title="Cost only total" data-placement="bottom" ><%=m.overall_cost.to_f.round(2)%></span></div>
      </div> 
      <div class="span4">
        <h3>Investment details</h3>
        <div class="input-prepend input-append "><span class="add-on"><i class="icon-share-alt"></i></span><span class="input-large uneditable-input" rel="tooltip" title="Gross yield" data-placement="bottom"><%=m.yield.to_f%></span></div>
        <div class="input-prepend input-append "><span class="add-on"><i class="icon-plus"></i></span><span class="input-large uneditable-input" rel="tooltip" title="Appreciation value" data-placement="bottom"><%=m.appreciation.to_f.round(2)%></span></div>
        <div class="input-prepend input-append "><span class="add-on"><i class="icon-minus"></i></span><span class="input-large uneditable-input" rel="tooltip" title="Depreciation value" data-placement="bottom" ><%=m.depreciation.to_f.round(2)%></span></div>
        <div class="input-prepend input-append "><span class="add-on"><i class="icon-tag"></i></span><span class="input-large uneditable-input" rel="tooltip" title="Total Rents" data-placement="bottom"><%=m.rents.to_i%></span></div>
      </div>

    </div>
  </div>
</div>
<div class="row-fluid">
  <div class="span12"> 
    <h3>Monthly repayment</h3>
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Month</th>
          <th>Capital</th>
          <th>Interest</th>
          <th>Balance</th>
        </tr>
      </thead>
      <tbody>
        <%m.repayments.each do |x| %>
          <%="<tr><td>#{x["month"]}</td><td>#{x["capital"].round(2)}</td><td>#{x["interest"].round(2)}</td><td>#{x["balance"].round(2)}</td></tr>"%>
        <%end%>
      </tbody>
    </table>
  </div>
</div>
<% else %>
<form action='/mortgage' method='post'>
  <div class="row-fluid">
    <div class="span12">
      <div class="span4">
        <h3>Morgage details</h3>
        <div class="input-prepend input-append"><span class="add-on"><i class="icon-home"></i></span><input type="text" id="property" name="property" value="85000"rel="tooltip" title="Property value" data-placement="bottom" ></div>
        <div class="input-prepend input-append"><span class="add-on"><i class="icon-align-right"></i></span><input type="text" id="interest" name="interest" value="3.99" rel="tooltip" title="Interest rate" data-placement="bottom"></div>
        <div class="input-prepend input-append"><span class="add-on"><i class="icon-download-alt"></i></span><input type="text" id="deposit" name="deposit" value="30" rel="tooltip" title="Deposit (in percent of the property)" data-placement="bottom"></div>
        <div class="input-prepend input-append"><span class="add-on"><i class="icon-calendar"></i></span><input type="text" id="length" name="length" value="60" rel="tooltip" title="Mortgage lenght in months" data-placement="bottom"></div>
        <div class="input-prepend input-append"><span class="add-on"><i class="icon-star"></i></span><input type="text" id="added_value" name="added_value" value="1000"rel="tooltip" title="Decorating, furnishing and refurbishment" data-placement="bottom" ></div>
      </div>

      <div class="span4">
        <h3>Cost details</h3>
        <div class="input-prepend input-append"><span class="add-on"><i class="icon-check"></i></span><input type="text" id="survey" name="survey" value="275" rel="tooltip" title="Survey cost" data-placement="bottom"></div>
        <div class="input-prepend input-append"><span class="add-on"><i class="icon-book"></i></span><input type="text" id="conveyancing" name="conveyancing" value="1000" rel="tooltip" title="Conveyancing cost" data-placement="bottom"></div>
        <div class="input-prepend input-append"><span class="add-on"><i class="icon-map-marker"></i></span><input type="text" id="ground_lease" name="ground_lease" value="0" rel="tooltip" title="Yearly ground lease cost" data-placement="bottom" ></div>
        <div class="input-prepend input-append"><span class="add-on"><i class="icon-wrench"></i></span><input type="text" id="charges" name="charges" value="0" rel="tooltip" title="Yearly service charges" data-placement="bottom" ></div>
        <div class="input-prepend input-append"><span class="add-on"><i class="icon-warning-sign"></i></span><input type="text" id="insurance" name="insurance" value="200" rel="tooltip" title="Yearly insurance charges" data-placement="bottom" ></div>
      </div> 

      <div class="span4">
        <h3>Investment details</h3>
        <div class="input-prepend input-append"><span class="add-on"><i class="icon-arrow-up"></i></span><input type="text" id="appreciation_rate" name="appreciation_rate" value="1.3"rel="tooltip" title="Appreciation rate" data-placement="bottom" ></div>
        <div class="input-prepend input-append"><span class="add-on"><i class="icon-arrow-down"></i></span><input type="text" id="depreciation_length" name="depreciation_length" value="27.5" rel="tooltip" title="Depreciation rate" data-placement="bottom" ></div>
        <div class="input-prepend input-append"><span class="add-on"><i class="icon-gift"></i></span><input type="text" id="rent" name="rent" value="600" rel="tooltip" title="Potential monthly rent" data-placement="bottom"></div>
        <div class="input-prepend input-append"><span class="add-on"><i class="icon-user"></i></span><input type="text" id="occupancy" name="occupancy" value="90.0" rel="tooltip" title="Occupancy rate" data-placement="bottom"></div>
        <div class="input-prepend input-append"><span class="add-on"><i class="icon-calendar"></i></span><input type="text" id="resell" name="resell" value="24"rel="tooltip" title="Month to resell" data-placement="bottom"></div>
      </div>

    </div>
  </div>

  <input class="btn btn-inverse" type='submit' value='Breakdown'>
</form>
<% end %>
